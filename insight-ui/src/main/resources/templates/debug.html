<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Spring Insight 调试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1>Spring Insight 数据调试</h1>

    <div class="mb-3">
        <a href="/insight-ui" class="btn btn-primary">返回首页</a>
        <a href="/insight-ui/debug/clear-cache" class="btn btn-warning" onclick="return confirm('确定要清除缓存吗？')">清除缓存</a>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Collector 连接状态</h5>
                </div>
                <div class="card-body">
                    <pre th:text="${collectorUrl}">collector url</pre>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">服务列表</h5>
                </div>
                <div class="card-body">
                    <div th:if="${services != null and not #lists.isEmpty(services)}">
                        <p>共 <span th:text="${#lists.size(services)}">0</span> 个服务</p>
                        <ul>
                            <li th:each="service : ${services}" th:text="${service}"></li>
                        </ul>
                    </div>
                    <div th:if="${services == null or #lists.isEmpty(services)}">
                        <p class="text-muted">暂无服务数据</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">数据统计</h5>
                </div>
                <div class="card-body">
                    <p>依赖关系: <span th:text="${dependencies != null ? #lists.size(dependencies) : 0}">0</span> 条</p>
                    <p>服务统计: <span th:text="${serviceStats != null ? #lists.size(serviceStats) : 0}">0</span> 个</p>
                    <p>错误分析: <span th:text="${errorAnalysis != null ? #lists.size(errorAnalysis) : 0}">0</span> 个</p>
                    <p>缓存大小: <span th:text="${cacheSize}">0</span></p>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">原始数据预览</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-sm btn-secondary mb-2" onclick="toggleRawData()">显示/隐藏原始数据</button>
                    <div id="raw-data" style="display: none; max-height: 300px; overflow: auto;">
                        <pre th:text="${rawJson}"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleRawData() {
        const el = document.getElementById('raw-data');
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }
</script>
</body>
</html>